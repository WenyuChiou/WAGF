# Task-040 C/E (AgentInitializer + TypeValidator) Implementation Plan

> **For Claude:** REQUIRED SUB-SKILL: Use superpowers:executing-plans to implement this plan task-by-task.

**Goal:** Implement AgentInitializer (040-C) and TypeValidator (040-E) for SA/MA unified architecture, with tests.

**Architecture:** Build a mode-aware agent initializer that supports survey/csv/synthetic sources and optional enrichers, and a governance validator that checks skill eligibility and type-specific rules. Both integrate with existing AgentTypeRegistry and validation flow.

**Tech Stack:** Python 3.10+, Pydantic dataclasses, pytest.

---

### Task 1: AgentInitializer – tests

**Files:**
- Create: `tests/test_agent_initializer.py`

**Step 1: Write failing tests**

```python
from pathlib import Path
import pandas as pd

from broker.core.agent_initializer import initialize_agents


def test_initialize_agents_csv(tmp_path: Path):
    csv_path = tmp_path / "agents.csv"
    pd.DataFrame([
        {"id": "A1", "agent_type": "household", "memory": "hello"}
    ]).to_csv(csv_path, index=False)

    agents, memories, stats = initialize_agents(
        mode="csv",
        path=csv_path,
        config={},
        seed=42,
    )

    assert len(agents) == 1
    assert "A1" in memories


def test_initialize_agents_synthetic(tmp_path: Path):
    agents, memories, stats = initialize_agents(
        mode="synthetic",
        path=tmp_path,
        config={},
        seed=42,
    )

    assert len(agents) > 0
```

**Step 2: Run tests to verify failure**

Run: `python -m pytest tests/test_agent_initializer.py -v`
Expected: FAIL (module missing).

---

### Task 2: AgentInitializer – implementation

**Files:**
- Create: `broker/core/agent_initializer.py`

**Step 1: Implement initializer**

```python
from pathlib import Path
from typing import Dict, Any, Optional, Tuple, List


def initialize_agents(
    mode: str,
    path: Path,
    config: Dict[str, Any],
    enrichers: Optional[Dict[str, Any]] = None,
    seed: int = 42,
) -> Tuple[List[Dict[str, Any]], Dict[str, List[Dict[str, Any]]], Dict[str, Any]]:
    # placeholder implementation; to be expanded
    ...
```

**Step 2: Run tests**

Run: `python -m pytest tests/test_agent_initializer.py -v`
Expected: PASS

**Step 3: Commit**

```bash
git add broker/core/agent_initializer.py tests/test_agent_initializer.py
git commit -m "feat(core): add agent initializer"
```

---

### Task 3: TypeValidator – tests

**Files:**
- Create: `tests/test_type_validator.py`

**Step 1: Write failing tests**

```python
from broker.governance.type_validator import TypeValidator


def test_type_validator_blocks_invalid_skill():
    validator = TypeValidator()
    results = validator.validate(
        skill_name="unknown_skill",
        agent_type="household",
        context={"valid_skills": ["do_nothing"]}
    )
    assert results
```

**Step 2: Run tests to verify failure**

Run: `python -m pytest tests/test_type_validator.py -v`
Expected: FAIL (module missing).

---

### Task 4: TypeValidator – implementation

**Files:**
- Create: `broker/governance/type_validator.py`

**Step 1: Implement validator**

```python
from typing import Dict, Any, List
from broker.interfaces.skill_types import ValidationResult


class TypeValidator:
    def validate(self, skill_name: str, agent_type: str, context: Dict[str, Any]) -> List[ValidationResult]:
        # placeholder implementation; to be expanded
        ...
```

**Step 2: Run tests**

Run: `python -m pytest tests/test_type_validator.py -v`
Expected: PASS

**Step 3: Commit**

```bash
git add broker/governance/type_validator.py tests/test_type_validator.py
git commit -m "feat(governance): add type validator"
```

---

## Execution Handoff

Plan complete and saved to `docs/plans/2026-01-28-task-040-ce.md`.

Two execution options:

1. **Subagent-Driven (this session)** - I dispatch fresh subagent per task, review between tasks
2. **Parallel Session (separate)** - Open new session with executing-plans, batch execution with checkpoints

Which approach?
