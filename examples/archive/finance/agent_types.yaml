# Complex Finance Agent Configuration (Heterogeneous)

default:
  parsing:
    keywords:
      [
        "Final Decision",
        "Choice",
        "Action",
        "Decision",
        "choose",
        "selected_action",
      ]
    skill_map:
      "1": "buy"
      "2": "sell"
      "3": "hold"
      "4": "do_nothing"
      "5": "buy_bulk"
      "6": "sell_bulk"
      "7": "rebalance"
    constructs:
      Strategy:
        keywords: ["Strategy", "Reasoning", "explain"]
        regex: "^(?:Strategy|\\*\\*Strategy\\*\\*|Strategy:)\\s*(.*?)(?=\\n\\n|\\n[A-Z]|$)"
      Confidence:
        keywords: ["Confidence", "certainty"]
        regex: "(?:Confidence|certainty):?\\s*([0-9.]+)"
      uncertainty:
        keywords: ["uncertainty"]
        regex: "uncertainty:?\\s*([0-9.]+)"
      sentiment_index:
        keywords: ["sentiment"]
        regex: "sentiment:?\\s*([0-9.]+)"
    preprocessor:
      type: "regex"
      pattern: "<think>.*?</think>"
  memory:
    weights:
      "high_profit": 0.9
      "major_loss": 0.9
      "routine": 0.2
    categories:
      "high_profit": ["profit", "gain", "surge", "upward", "bought"]
      "major_loss": ["loss", "crash", "decline", "bearish", "sold"]
  log_fields: ["Strategy"]

retail_trader:
  prompt_template: |
    CRITICAL: You MUST respond in the following format. 
    1. Decision must be one of the [Numbers] from available options.
    2. JSON must be wrapped in <<<DECISION_START>>> and <<<DECISION_END>>>.
    3. Do NOT include any other text.

    Example Output:
    <<<DECISION_START>>>
    {{
      "strategy": "Buying due to positive peer sentiment and low price.",
      "confidence": 0.85,
      "decision": 1
    }}
    <<<DECISION_END>>>

    You are a RETAIL TRADER ({agent_name}). 
    You manage your personal savings and are often influenced by market sentiment and peer chatter.

    [MARKET ENVIRONMENT]
    Price: ${market_price:.2f}, Sentiment: {sentiment_index:.2f}, Uncertainty: {uncertainty:.2f}
    News: {global_news}

    [SOCIAL SIGNALS (Peer Gossip)]
    {social_gossip}

    [PERSONAL STATE]
    Cash: ${cash_balance:.2f}, Shares: {shares}, Portfolio Value: ${portfolio_value:.2f}
    Risk Tolerance: {risk_tolerance}

    [AVAILABLE OPTIONS]
    [1] Buy: Purchase shares.
    [2] Sell: Liquidate shares.
    [3] Hold: Maintain position.
    [4] Do Nothing.

  governance:
    strict: {}

institutional_investor:
  prompt_template: |
    CRITICAL: You MUST respond in the following format. 
    1. Decision must be one of the [Numbers] from available options.
    2. JSON must be wrapped in <<<DECISION_START>>> and <<<DECISION_END>>>.
    3. Do NOT include any other text.

    Example Output:
    <<<DECISION_START>>>
    {{
      "strategy": "Mandate requires rebalancing due to high AUM.",
      "confidence": 0.9,
      "decision": 7
    }}
    <<<DECISION_END>>>

    You are an INSTITUTIONAL INVESTOR ({agent_name}).
    [MARKET ENVIRONMENT]
    Price: ${market_price:.2f}, Sentiment: {sentiment_index:.2f}, Uncertainty: {uncertainty:.2f}
    News: {global_news}

    [FUND STATE]
    AUM: ${portfolio_value:.2f}, Cash: ${cash_balance:.2f}, Risk: {risk_tolerance}

    [AVAILABLE OPTIONS]
    [3] Hold
    [4] Do Nothing
    [5] Buy Bulk
    [6] Sell Bulk
    [7] Rebalance

  governance:
    strict:
      thinking_rules:
        - id: "institutional_discipline"
          conditions:
            - construct: "uncertainty"
              operator: ">"
              value: 0.9
          blocked_skills: ["buy_bulk", "sell_bulk"]
          message: "Extreme uncertainty detected. Institutional mandate requires shifting to Hold/Do Nothing."
